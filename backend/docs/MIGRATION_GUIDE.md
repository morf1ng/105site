# Руководство по миграции на множественные роли

## Что изменилось

Система теперь поддерживает назначение нескольких ролей одному пользователю. Роли хранятся в поле `role_ids` как строка с ID через запятую (например: "1,2,3").

## Шаги для применения изменений

### 1. Остановите приложение

Перед миграцией остановите работающее приложение.

### 2. Создайте резервную копию базы данных

```bash
# Если используете SQLite
copy your_database.db your_database.db.backup

# Если используете PostgreSQL
pg_dump your_database > backup.sql
```

### 3. Выполните миграцию

```bash
python -m app.migrate_role_ids
```

### 4. Запустите приложение

После успешной миграции запустите приложение обычным способом.

## Изменения в API

### Создание пользователя (было)
```bash
curl -X POST "/admin/users" \
  -F "email=user@example.com" \
  -F "password=pass123" \
  -F "role_id=1"
```

### Создание пользователя (стало)
```bash
curl -X POST "/admin/users" \
  -F "email=user@example.com" \
  -F "password=pass123" \
  -F "role_ids=1,2,3"  # Можно указать несколько ролей через запятую
```

## Проверка после миграции

1. Войдите в систему как администратор
2. Проверьте список пользователей: `GET /admin/users`
3. Создайте тестового пользователя с несколькими ролями
4. Проверьте, что токены содержат массив ролей

## Откат изменений

Если что-то пошло не так:

1. Остановите приложение
2. Восстановите базу данных из резервной копии
3. Откатите изменения в коде (используйте git)

```bash
git checkout HEAD~1
```

## Поддержка

Подробная документация: `docs/MULTIPLE_ROLES.md`
